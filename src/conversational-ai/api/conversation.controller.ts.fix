// Quick fix for WebSocket protocol detection
// The issue is that Railway doesn't always set x-forwarded-proto correctly

// Option 1: Force wss:// for known production domains
const wsHost = process.env.WS_HOST || req.get('host');
const isProduction = wsHost?.includes('railway.app') || wsHost?.includes('your-production-domain.com');
const wsProtocol = isProduction ? 'wss' : 'ws';

// Option 2: Use environment variable
const wsProtocol = process.env.FORCE_WSS === 'true' ? 'wss' : (req.get('x-forwarded-proto') === 'https' ? 'wss' : 'ws');

// Option 3: Check original protocol from request
const originalProtocol = req.protocol || req.get('x-forwarded-proto') || 'http';
const wsProtocol = originalProtocol.includes('https') ? 'wss' : 'ws';